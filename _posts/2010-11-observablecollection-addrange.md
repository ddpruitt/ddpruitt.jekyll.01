---
date: '2010-11-05T07:15:00.000-07:00'
description: ''
published: true
slug: 2010-11-observablecollection-addrange
tags:
- .Net
- http://schemas.google.com/blogger/2008/kind#post
- legacy-blogger
time_to_read: 5
title: ObservableCollection AddRange
---

*This was originally posted on blogger [here](https://techshorts.blogspot.com/2010/11/observablecollection-addrange.html)*.

<a href="http://www.damonpayne.com">Damon Payne</a> has a post <a href="http://www.damonpayne.com/2010/03/04/AddRangeForObservableCollectionInSilverlight3.aspx">AddRange for ObservableCollection in Silverlight 3</a>.  It is pretty short and sweet way to improve performance when batch adding data to an ObservableCollection.<br /><br />He created a SmartCollection:<br /><br />[csharp]<br />    public class SmartCollection&lt;T&gt; : ObservableCollection&lt;T&gt;<br />    {<br />        public SmartCollection()<br />        {<br />            _suspendCollectionChangeNotification = false;<br />        }<br /><br /><br />        bool _suspendCollectionChangeNotification;<br /><br />        protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)<br />        {<br />            if (!_suspendCollectionChangeNotification)<br />            {<br />                base.OnCollectionChanged(e);<br />            }<br />        }<br /><br />        public void SuspendCollectionChangeNotification()<br />        {<br />            _suspendCollectionChangeNotification = true;<br />        }<br /><br />        public void ResumeCollectionChangeNotification()<br />        {<br />            _suspendCollectionChangeNotification = false;<br />        }<br /><br /><br />        public void AddRange(IEnumerable&lt;T&gt; items)<br />        {<br />            this.SuspendCollectionChangeNotification();<br />            try<br />            {<br />                foreach (var i in items)<br />                    base.InsertItem(Count, i);<br />            }<br />            finally<br />            {<br />                this.ResumeCollectionChangeNotification();<br />                <br />                var arg = new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset);<br />                this.OnCollectionChanged(arg);<br />            }<br />        }<br />    }<br />[/csharp]<br /><br />I created a scratch / test app to see if it works:<br /><br />[xml]<br />&lt;UserControl     <br />    x:Class=&quot;SilverlightApplication10.MainPage&quot;<br />    xmlns=&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;<br />    xmlns:x=&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;<br />    xmlns:d=&quot;http://schemas.microsoft.com/expression/blend/2008&quot;<br />    xmlns:mc=&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot; <br />    xmlns:my=&quot;clr-namespace:System.Windows.Controls;assembly=System.Windows.Controls.Data&quot; <br />    mc:Ignorable=&quot;d&quot;<br />    d:DesignHeight=&quot;300&quot; d:DesignWidth=&quot;400&quot;&gt;<br /><br />    &lt;Grid x:Name=&quot;LayoutRoot&quot; Background=&quot;White&quot;&gt;<br />        &lt;StackPanel Orientation=&quot;Horizontal&quot;&gt;<br />            &lt;StackPanel Margin=&quot;5&quot;&gt;<br />                &lt;StackPanel Orientation=&quot;Horizontal&quot; Margin=&quot;5&quot;&gt;<br />                    &lt;TextBlock x:Name=&quot;SlowText&quot; Height=&quot;50&quot;  Width=&quot;100&quot;/&gt;<br />                    &lt;Button x:Name=&quot;SlowButton&quot; Content=&quot;Slow&quot; Click=&quot;SlowButtonClick&quot;/&gt;<br />                &lt;/StackPanel&gt;<br />                &lt;my:DataGrid x:Name=&quot;SlowDataView&quot;<br />                             Height=&quot;300&quot; <br />                             AutoGenerateColumns=&quot;True&quot; <br />                             RowBackground=&quot;Cornsilk&quot;<br />                             AlternatingRowBackground=&quot;LightGray&quot;/&gt;<br />            &lt;/StackPanel&gt;<br /><br />            &lt;StackPanel Margin=&quot;5&quot;&gt;<br />                &lt;StackPanel Orientation=&quot;Horizontal&quot; Margin=&quot;5&quot;&gt;<br />                    &lt;TextBlock x:Name=&quot;FastText&quot; Height=&quot;50&quot;  Width=&quot;100&quot;/&gt;<br />                    &lt;Button x:Name=&quot;FastButton&quot; Content=&quot;Fast&quot; Click=&quot;FastButtonClick&quot;/&gt;<br />                &lt;/StackPanel&gt;<br />                &lt;my:DataGrid x:Name=&quot;FastDataView&quot; <br />                             Height=&quot;300&quot; <br />                             AutoGenerateColumns=&quot;True&quot; <br />                             RowBackground=&quot;Cornsilk&quot;<br />                             AlternatingRowBackground=&quot;LightGray&quot;/&gt;<br />            &lt;/StackPanel&gt;<br />        &lt;/StackPanel&gt;<br />    &lt;/Grid&gt;<br />&lt;/UserControl&gt;<br />[/xml]<br /><br />[csharp]<br />    public partial class MainPage : UserControl<br />    {<br />        public MainPage()<br />        {<br />            InitializeComponent();<br />            _slowCollection = new ObservableCollection&lt;MyClass&gt;();<br />            SlowDataView.ItemsSource = _slowCollection;<br /><br />            _fastCollection = new SmartCollection&lt;MyClass&gt;();<br />            FastDataView.ItemsSource = _fastCollection;<br />        }<br /><br />        #region Slow<br /><br />        private readonly ObservableCollection&lt;MyClass&gt; _slowCollection;<br />        private void SlowButtonClick(object sender, RoutedEventArgs e)<br />        {<br />            var timeSpan = Time(() =&gt; { for (int i = 0; i &lt; 25000; i++) _slowCollection.Add(MyClass.BuildRandom()); });<br />            Dispatcher.BeginInvoke(() =&gt; this.SlowText.Text = timeSpan.ToString());<br />        }<br /><br />        #endregion<br /><br />        #region Fast<br /><br />        private readonly SmartCollection&lt;MyClass&gt; _fastCollection;<br />        private void FastButtonClick(object sender, RoutedEventArgs e)<br />        {<br />            <br />            var timeSpan = Time(() =&gt;<br />                                    {<br />                                        var list = new List&lt;MyClass&gt;();<br />                                        for (int i = 0; i &lt; 25000; i++) list.Add(MyClass.BuildRandom());<br />                                        _fastCollection.AddRange(list);<br />                                    });<br /><br /><br />            Dispatcher.BeginInvoke(() =&gt; this.FastText.Text = timeSpan.ToString());<br />        }<br /><br />        #endregion<br /><br />        private static TimeSpan Time(Action a)<br />        {<br />            var start = DateTime.Now;<br />            a();<br />            var end = DateTime.Now;<br />            return end - start;<br />        }<br />    }<br />[/csharp]<br /><br />[csharp]<br />    internal class MyClass : INotifyPropertyChanged<br />    {<br />        private static Random _random;<br /><br />        #region Id<br /><br />        private string _id;<br /><br />        public string Id<br />        {<br />            get { return _id; }<br />            set<br />            {<br />                if (value != _id)<br />                {<br />                    _id = value;<br />                    NotifyPropertyChanged(&quot;Id&quot;);<br />                }<br />            }<br />        }<br /><br />        #endregion<br /><br />        #region SomeRandomNumber<br /><br />        private int _someRandomNumber;<br /><br />        public int SomeRandomNumber<br />        {<br />            get { return _someRandomNumber; }<br />            set<br />            {<br />                if (value != _someRandomNumber)<br />                {<br />                    _someRandomNumber = value;<br />                    NotifyPropertyChanged(&quot;SomeRandomNumber&quot;);<br />                }<br />            }<br />        }<br /><br />        #endregion<br /><br />        #region INotifyPropertyChanged<br /><br />        public event PropertyChangedEventHandler PropertyChanged;<br /><br />        public void NotifyPropertyChanged(string propertyName)<br />        {<br />            var propertyChanged = PropertyChanged;<br />            if (propertyChanged != null)<br />                propertyChanged(this, new PropertyChangedEventArgs(propertyName));<br />        }<br /><br />        #endregion<br /><br />        public static MyClass BuildRandom()<br />        {<br />            if(_random==null)<br />                _random = new Random((int) DateTime.Now.Ticks);<br /><br />            var myclass = new MyClass<br />                              {<br />                                  Id = Guid.NewGuid().ToString(&quot;N&quot;),<br />                                  SomeRandomNumber = _random.Next(1, 100)<br />                              };<br /><br />            return myclass;<br />        }<br />    }<br />[/csharp]<br /><br />Running the code shows that indeed the AddRange works well to speed up inserts.  I was getting about 15 to 25 seconds on the Slow Data and from 3 to 0.09 seconds on the Fast Data.  It was interesting to note that if the Slow button was pressed a second time it actually took longer than the first click, but the Fast button had the opposite affect.