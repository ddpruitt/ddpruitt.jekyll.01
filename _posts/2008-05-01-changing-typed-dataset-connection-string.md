---
date: '2008-05-13T13:26:00.000-07:00'
description: ''
published: true
slug: 2008-05-changing-typed-dataset-connection-string
tags:
- .Net
- http://schemas.google.com/blogger/2008/kind#post
- legacy-blogger
time_to_read: 5
title: Changing Typed DataSet Connection String
---

*This was originally posted on blogger [here](https://techshorts.blogspot.com/2008/05/changing-typed-dataset-connection-string.html)*.

I was working on a WinForm app that connected to a MS Access database.  Yeah, Access sucks but I didn't have a choice in the matter.<br /><br />The app itself is used to import a bunch of CSV files into the Access database.  It is more of a utility program and it has going through several variations, from being a simple hand driven command line tool to being GUI driven.<br /><br />The command line version was all hand controlled.  I had to go in and update configuration files to point to the CSV files and the MDB database.  That got old fast so I decided to make a GUI version that would allow me to pick the MDB file and each of the CSV files to import.  Picking and using the CSV files was easy, it was changing the connection string for the MDB that proved to be the hardest.<br /><br />I am using strongly typed datasets in VS2005.  If you have ever worked with them you find out soon that the connection string gets saved with the project in the app.config file, even if it is a seperate DAL dll project.  My guess is that Microsoft assumed that if you ever had a connection to one database then your strongly typed dataset would not have to change to another database, but if you did you could always just update the configuration file.<br /><br />As my drill instructor was always fond of saying:  "Wrong f***ing answer!"<br /><br />I wanted, in the case, to use a strongly typed dataset.  I also wanted to use different Access files, and I wanted to be able to select which Access file I used while the application was running.  Why is that so hard?<br /><br />I searched the web and found several not so useful suggestions.  It appears that there are two camps of people for this issue:  Those that understood what I wanted to do and were trying to do it also, and those that didn't understand what the problem was.<br /><br />Those in the latter camp always resorted to the same suggestion:  Just update the configuration files to point to the new database.  This doesn't work in this case because I would then have to restart the app in order for the new setting to be picked up.<br /><br />The other popular option was to completely re-write the Settings.Designer.cs file so that when the DataTables called to get the connection string it would call a method you created so you could pass anything into it you wanted.  The problem with this approach is that if you changed any of the other settings then your code would get over-written by Visual Studio.<br /><br />The least popular option was to go to each DataTable and create partial classes that override the InitConnection() method.  This royally sucks if you have lots of DataTables.<br /><br />In the Settings class, all Connection String types are application level and cannot be made into User Settings.  This leads to the other issue, namely all Connection String settings are read-only.  But this is true only for saving the connection string, which is not something I needed to do.  I just need to be able to change it.<br /><br />Also the Settings class is internal and sealed, which means it cannot be accessed from outside of the current project.  So my GUI project cannot directly access my DAL project and update the Settings value.  To get around that limitation I just created a proxy class.  The resulting class is:<br /><br /><br /><!-- {\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red0\green0\blue255;\red255\green255\blue255;\red0\green0\blue0;\red43\green145\blue175;\red0\green128\blue0;\red163\green21\blue21;}??\fs20 \cf1 using\cf0  DC.Catalog.DAL.Properties;\par ??\par ??\cf1 namespace\cf0  DC.Catalog.DAL\par ??\{\par ??    \cf1 public\cf0  \cf1 static\cf0  \cf1 class\cf0  \cf4 EquipmentConnectionSettings\par ??\cf0     \{\par ??        \cf1 public\cf0  \cf1 static\cf0  \cf1 void\cf0  SetEquipmentToConnectToMdb(\cf1 string\cf0  MdbFilename)\par ??        \{\par ??            \cf5 // This only overrides the in-memory copy of the setting.  It is not perminate.\par ??\cf0             \cf4 Settings\cf0 .Default[\cf6 "EquipmentConnectionString"\cf0 ] = \cf1 string\cf0 .Format(\par ??                \cf4 Settings\cf0 .Default.EquipmentConnectionStringTemplate\par ??                , MdbFilename);\par ??        \}\par ??    \}\par ??\}} --><div><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    1</span> <span style="color: blue;">using</span> DC.Catalog.DAL.Properties;</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    2</span> </pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    3</span> <span style="color: blue;">namespace</span> DC.Catalog.DAL</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    4</span> {</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    5</span>     <span style="color: blue;">public </span><span style="color: blue;">static</span><span style="color: blue;"> class</span><span style="color: rgb(43, 145, 175);">EquipmentConnectionSettings</span></pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    6</span>     {</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    7</span>         <span style="color: blue;">public </span><span style="color: blue;">static </span><span style="color: blue;">void</span> SetEquipmentToConnectToMdb(<span style="color: blue;">string</span> MdbFilename)</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    8</span>         {</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">    9</span>             <span style="color: green;">// This only overrides the in-memory copy of the setting.  It is not perminate.</span></pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">   10</span>             <span style="color: rgb(43, 145, 175);">Settings</span>.Default[<span style="color: rgb(163, 21, 21);">"EquipmentConnectionString"</span>] = <span style="color: blue;">string</span>.Format(</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">   11</span>                 <span style="color: rgb(43, 145, 175);">Settings</span>.Default.EquipmentConnectionStringTemplate</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">   12</span>                 , MdbFilename);</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">   13</span>         }</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">   14</span>     }</pre><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">   15</span> }</pre></div><br />Notice that to update the setting value I had to use:<br /><br /><!-- {\rtf1\ansi\ansicpg\lang1024\noproof1252\uc1 \deff0{\fonttbl{\f0\fnil\fcharset0\fprq1 Courier New;}}{\colortbl;??\red43\green145\blue175;\red255\green255\blue255;\red0\green0\blue0;\red163\green21\blue21;}??\fs20 \cf1 Settings\cf0 .Default[\cf4 "EquipmentConnectionString"\cf0 ]} --><div><pre style="margin: 0px;"><span style="color: rgb(43, 145, 175);">Settings</span>.Default[<span style="color: rgb(163, 21, 21);">"EquipmentConnectionString"</span>]</pre></div><br /><span style="font-family: monospace;">Since the setting </span><span style="color: rgb(43, 145, 175); font-family: courier new,courier,monospace;">Settings</span><span style="font-family: courier new,courier,monospace;">.Default.</span><span style="color: rgb(163, 21, 21);"><span style="font-family: courier new,courier,monospace;">EquipmentConnectionString</span> </span><span style="font-family: verdana;">is readonly I had to use the other way to access the value.  The EquipmentConnectionStringTemplate is simple: <br /><br /><br />></span><div style="margin-left: 40px;"><span style="font-family: courier new,courier,monospace;">Provider=Microsoft.Jet.OLEDB.4.0;Data Source={0}</span><br /><span style="font-family: verdana;"></span></div><span style="font-family: verdana;"><br />Every time I change the Access file I am pointing at I call the SetEquipmentToConnectToMdb() method, magic happens in the Typed DataSet and it all just works.<br /><br /><br /><br /></span><span style="font-family: monospace;"></span>