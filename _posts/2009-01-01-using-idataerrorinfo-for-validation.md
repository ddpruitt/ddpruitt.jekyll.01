---
date: '2009-01-28T10:10:00.000-08:00'
description: ''
published: true
slug: 2009-01-using-idataerrorinfo-for-validation
tags:
- .Net
- http://schemas.google.com/blogger/2008/kind#post
- Rant
- legacy-blogger
time_to_read: 5
title: Using IDataErrorInfo for Validation
---

*This was originally posted on blogger [here](https://techshorts.blogspot.com/2009/01/using-idataerrorinfo-for-validation.html)*.

I read an article on <a href="http://www.codeproject.com">CodeProject</a> titled <a href="http://www.codeproject.com/KB/WPF/GlobalWPFValidation.aspx">Total View Validation</a> where the author complains that IDataErrorInfo is inadequate for WPF validation.  The assumption he makes is that all the validation code needs to go into the IDataErrorInfo.this[string] property as such:<br /><br />[csharp]<br />public string this[string name]<br />{<br />   get<br />    {<br />        string result = null;<br />        if (name == &quot;Age&quot;)<br />        {<br />            if (this.age &lt; 0 || this.age &gt; 150)<br />            {<br />                result = &quot;Age must not be less than 0 or greater than 150.&quot;;<br />            }<br />        }<br />        return result;<br />    }<br />}<br />[/csharp]<br /><br />This should not be the way that IDataErrorInfo is used as it puts business logic in the model, as the author points out.  His solution though was to create another mechanism to notifiy the user of validation errors and to not use IDataErrorInfo at all.<br /><br />A solution I would propose though would be to follow how DataTables and DataTables use IDataErrorInfo by implementing methods to set and clear the objects error information:<br /><br />[csharp]<br />    public class SomeClass : IDataErrorInfo<br />    {<br /><br />        public string Name { get; set; }<br /><br />        public string Age { get; set; }<br /><br />        #region Data Error Info<br /><br />        private Dictionary&lt;string, string&gt; _propertyErrors;<br /><br />        private void InitDataErrorInfo()<br />        {<br />            var properties = this.GetType().GetProperties();<br /><br />            _propertyErrors = new Dictionary&lt;string, string&gt;<br />            {<br />                // This will act as an overall error message for the entire object.    <br />                {this.GetHashCode().ToString(CultureInfo.InvariantCulture), string.Empty}<br />            };<br /><br /><br />            foreach (var propertyInfo in properties)<br />                _propertyErrors.Add(propertyInfo.Name, string.Empty);<br />        }<br /><br />        public void ClearDataErrorInfo()<br />        {<br />            foreach (var property in _propertyErrors.Keys)<br />                _propertyErrors[property] = string.Empty;<br />        }<br /><br />        public void ClearDataErrorInfo(string propertyName)<br />        {<br />            AssertThisHasPropertyWithName(propertyName);<br />            _propertyErrors[propertyName] = string.Empty;<br />        }<br /><br />        public void SetError(string error)<br />        {<br />            SetError(this.GetHashCode().ToString(CultureInfo.InvariantCulture), error);<br />        }<br /><br />        public void SetError(string propertyName, string error)<br />        {<br />            AssertThisHasPropertyWithName(propertyName);<br />            _propertyErrors[propertyName] = string.Format(&quot;{0}{1}{2}&quot;, _propertyErrors[propertyName]<br />                , Environment.NewLine, error);<br />        }<br /><br />        public string this[string propertyName]<br />        {<br />            get<br />            {<br />                AssertThisHasPropertyWithName(propertyName);<br />                return _propertyErrors[propertyName];<br />            }<br /><br />        }<br /><br />        public string Error<br />        {<br />            get<br />            {<br />                var errors = new StringBuilder();<br />                foreach (<br />                    var propertyError in<br />                        _propertyErrors.Where(propertyError =&gt; !string.IsNullOrEmpty(propertyError.Value)))<br />                    errors.AppendLine(propertyError.Value);<br /><br />                return errors.ToString().Trim();<br />            }<br />        }<br /><br />        protected void AssertThisHasPropertyWithName(string propertyName)<br />        {<br />            if (!_propertyErrors.ContainsKey(propertyName))<br />            {<br />                throw new ArgumentException(string.Format(&quot;No property named {0} on {1}.&quot;<br />                    , propertyName, this.GetType().FullName));<br />            }<br />        }<br /><br />        #endregion<br />    }<br />[/csharp]<br /><br />Note that there is no validation here, only reporting if the object has errors.  Using this takes advantage of the already existing validation notification built into WPF as well as WinForms.